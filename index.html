<!DOCTYPE html>
<html>
<head>
            <style></style>
        </head>
        <body>
            


    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bulk File Printer &amp; PDF Merger</title>
    <style>
        :root {
            --primary-color: #007bff;
            --secondary-color: #6c757d;
            --light-color: #f8f9fa;
            --dark-color: #343a40;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --info-color: #17a2b8;
            --warning-color: #ffc107;
            --border-radius: 12px;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease-in-out;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #e9ecef;
            min-height: 100vh;
            padding: 20px;
            color: var(--dark-color);
            line-height: 1.6;
        }

        .container {
            max-width: 1100px;
            margin: 0 auto;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            overflow: hidden;
        }

        .header {
            text-align: center;
            padding: 40px 20px;
            background: linear-gradient(135deg, var(--primary-color), #0056b3);
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .main-content {
            padding: 30px;
        }

        .controls-section {
            background: var(--light-color);
            padding: 20px;
            border-radius: var(--border-radius);
            margin-bottom: 30px;
            text-align: center;
        }
        
        .upload-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .upload-btn {
            background: white;
            color: var(--primary-color);
            border: 2px solid var(--primary-color);
            padding: 15px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: var(--transition);
        }

        .upload-btn:hover {
            background: var(--primary-color);
            color: white;
            transform: translateY(-2px);
        }
        
        .upload-note {
            font-size: 0.85rem;
            color: var(--secondary-color);
        }

        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 30px;
            border-top: 1px solid #dee2e6;
            padding-top: 20px;
            flex-wrap: wrap;
        }

        .print-btn, .reset-btn, .merge-btn {
            color: white;
            border: none;
            padding: 12px 35px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: var(--transition);
        }
        
        .print-btn {
            background: linear-gradient(135deg, var(--success-color), #1e7e34);
        }
        
        .reset-btn {
            background: linear-gradient(135deg, var(--danger-color), #a71d2a);
        }
        
        .merge-btn {
            background: linear-gradient(135deg, var(--primary-color), #0056b3);
        }

        .print-btn:hover, .reset-btn:hover, .merge-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }
        
        .print-btn:disabled, .reset-btn:disabled, .merge-btn:disabled {
            background: #ced4da;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .preview-area {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 20px;
            min-height: 100px;
        }
        
        .file-type-stats {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .file-stat {
            background: var(--light-color);
            padding: 10px 20px;
            border-radius: 30px;
            font-size: 0.9rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .file-stat.image {
            color: var(--success-color);
            border: 1px solid var(--success-color);
        }
        
        .file-stat.pdf {
            color: var(--danger-color);
            border: 1px solid var(--danger-color);
        }
        
        .file-stat.doc {
            color: var(--primary-color);
            border: 1px solid var(--primary-color);
        }

        .file-card {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            transition: var(--transition);
            border: 1px solid #dee2e6;
        }
        
        .file-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }

        .preview-container {
            height: 180px;
            background-color: var(--light-color);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        
        .preview-container img, .preview-container iframe {
            width: 100%;
            height: 100%;
            object-fit: contain;
            border: none;
        }

        .file-icon {
            width: 60px;
            height: 60px;
            color: var(--secondary-color);
        }
        
        .file-checkbox {
            position: absolute;
            top: 10px;
            right: 10px;
            transform: scale(1.5);
        }
        
        .unsupported-text {
            position: absolute;
            bottom: 10px;
            left: 10px;
            right: 10px;
            background: rgba(0,0,0,0.6);
            color: white;
            font-size: 0.8rem;
            padding: 5px;
            border-radius: 4px;
            text-align: center;
        }

        .file-info {
            padding: 15px;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        .file-name {
            font-weight: 600;
            word-break: break-all;
            flex-grow: 1;
            margin-bottom: 5px;
        }

        .file-details {
            font-size: 0.85rem;
            color: var(--secondary-color);
        }
        
        .card-actions {
            display: flex;
            gap: 5px;
            margin-top: 15px;
        }

        .remove-file-btn, .print-pdf-btn {
            flex-grow: 1;
            color: white;
            border: none;
            padding: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: background-color 0.2s;
            border-radius: 8px;
        }
        
        .remove-file-btn {
            background: var(--danger-color);
        }

        .print-pdf-btn {
             background: var(--info-color);
        }
        
        .remove-file-btn:hover {
            background: #a71d2a;
        }
        
        .print-pdf-btn:hover {
            background: #117a8b;
        }

        .status-message {
            padding: 15px 20px;
            border-radius: 8px;
            margin: 0 0 20px 0;
            text-align: center;
            font-weight: 600;
            border: 1px solid;
        }

        .status-info {
            background: #d1ecf1;
            color: #0c5460;
            border-color: #bee5eb;
        }
        
        .status-warning {
            background: #fff3cd;
            color: #856404;
            border-color: #ffeeba;
        }
        
        .status-success {
            background: #d4edda;
            color: #155724;
            border-color: #c3e6cb;
        }
        
        .status-error {
            background: #f8d7da;
            color: #721c24;
            border-color: #f5c6cb;
        }

        .progress-container {
            margin: 20px 0;
            display: none;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), #0056b3);
            width: 0%;
            transition: width 0.3s ease;
        }

        .progress-text {
            text-align: center;
            margin-top: 5px;
            font-weight: 600;
            font-size: 0.9rem;
            color: var(--secondary-color);
        }
    </style>


    <div class="container">
        <div class="header">
            <h1>Bulk File Printer &amp; PDF Merger</h1>
            <p>Select multiple files to print or merge them into a single document.</p>
        </div>

        <div class="main-content">
            <div class="controls-section">
                <!-- Inputs are hidden, labels act as buttons -->
                <input type="file" id="fileInput" multiple="" accept="image/*,application/pdf,.doc,.docx" style="display: none;">
                <input type="file" id="folderInput" webkitdirectory="" directory="" multiple="" style="display: none;">
                
                <div class="upload-buttons">
                    <label for="fileInput" class="upload-btn">Select Files</label>
                    <label for="folderInput" class="upload-btn">Select Folder</label>
                </div>
                <p class="upload-note">Note: Images can be bulk printed. PDFs can be merged into a single document. DOC/DOCX files must be handled separately.</p>
            </div>
            
            <div id="fileStats" class="file-type-stats">
                    <div class="file-stat pdf">
                        <span>üìÑ</span>
                        <span>2 PDFs</span>
                    </div>
                </div>
            
            <div id="statusMessage" class="status-message status-success" style="display: block;">PDFs merged successfully! Opening print dialog...</div>
            
            <div id="progressContainer" class="progress-container" style="display: none;">
                <div class="progress-bar">
                    <div id="progressFill" class="progress-fill" style="width: 100%;"></div>
                </div>
                <div id="progressText" class="progress-text">PDF merge complete!</div>
            </div>

            <div class="preview-area" id="previewArea">
           
            <div class="action-buttons">
                <button class="print-btn" id="printBtn" disabled="">üñ®Ô∏è Print All Images</button>
                <button class="merge-btn" id="mergePdfBtn">üîÑ Merge &amp; Print PDFs</button>
                <button class="reset-btn" id="resetBtn">üóëÔ∏è Reset All</button>
            </div>
        </div>
    </div>

    <!-- PDF-LIB for PDF merging -->
    <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
    
    <script>
        // DOM Elements
        const fileInput = document.getElementById('fileInput');
        const folderInput = document.getElementById('folderInput');
        const previewArea = document.getElementById('previewArea');
        const printBtn = document.getElementById('printBtn');
        const mergePdfBtn = document.getElementById('mergePdfBtn');
        const resetBtn = document.getElementById('resetBtn');
        const statusMessage = document.getElementById('statusMessage');
        const progressContainer = document.getElementById('progressContainer');
        const progressFill = document.getElementById('progressFill');
        const progressText = document.getElementById('progressText');
        const fileStats = document.getElementById('fileStats');

        let selectedFiles = new Map(); // Use a Map to prevent duplicates and store File objects

        // --- Event Listeners ---
        fileInput.addEventListener('change', (event) => handleFiles(event.target.files));
        folderInput.addEventListener('change', (event) => handleFiles(event.target.files));
        printBtn.addEventListener('click', handleImagePrint);
        mergePdfBtn.addEventListener('click', mergePdfFiles);
        resetBtn.addEventListener('click', resetAll);
        
        // --- Core Functions ---

        function handleFiles(files) {
            for (const file of files) {
                if (!selectedFiles.has(file.name)) {
                    selectedFiles.set(file.name, file);
                    createFileCard(file);
                }
            }
            updateStats();
            updateButtonsState();
        }

        function createFileCard(file) {
            const card = document.createElement('div');
            card.className = 'file-card';
            card.dataset.filename = file.name;

            const previewContainer = document.createElement('div');
            previewContainer.className = 'preview-container';

            const fileType = getFileType(file);
            const actionsDiv = document.createElement('div');
            actionsDiv.className = 'card-actions';

            switch (fileType) {
                case 'image':
                    const img = document.createElement('img');
                    img.src = URL.createObjectURL(file);
                    img.alt = `Preview of ${file.name}`;
                    img.onload = () => URL.revokeObjectURL(img.src);
                    previewContainer.appendChild(img);
                    break;
                case 'pdf':
                    previewContainer.innerHTML = getIconSVG('pdf');
                    // Add a PDF checkbox for merging
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.className = 'file-checkbox pdf-checkbox';
                    checkbox.checked = true;
                    checkbox.onchange = updateButtonsState;
                    previewContainer.appendChild(checkbox);
                    
                    // Individual print button
                    actionsDiv.innerHTML += `<button class="print-pdf-btn" onclick="handlePdfPrint('${file.name}')">üñ®Ô∏è Print</button>`;
                    break;
                case 'doc':
                     previewContainer.innerHTML = getIconSVG('doc');
                     previewContainer.innerHTML += `<div class="unsupported-text">DOC files can't be merged</div>`;
                    break;
                default:
                     previewContainer.innerHTML = getIconSVG('generic');
                     previewContainer.innerHTML += `<div class="unsupported-text">Unsupported File</div>`;
                    break;
            }

            const infoDiv = document.createElement('div');
            infoDiv.className = 'file-info';
            infoDiv.innerHTML = `
                <div class="file-name">${file.name}</div>
                <div class="file-details">${formatBytes(file.size)}</div>
            `;
            
            // Add the remove button to all cards
            actionsDiv.innerHTML += `<button class="remove-file-btn" onclick="removeFile('${file.name}')">Remove</button>`;
            infoDiv.appendChild(actionsDiv);

            card.appendChild(previewContainer);
            card.appendChild(infoDiv);
            previewArea.appendChild(card);
        }
        
        function updateStats() {
            const stats = {
                images: 0,
                pdfs: 0,
                docs: 0
            };
            
            selectedFiles.forEach(file => {
                const type = getFileType(file);
                if (type === 'image') stats.images++;
                if (type === 'pdf') stats.pdfs++;
                if (type === 'doc') stats.docs++;
            });
            
            fileStats.innerHTML = '';
            
            if (stats.images > 0) {
                fileStats.innerHTML += `
                    <div class="file-stat image">
                        <span>üì∑</span>
                        <span>${stats.images} Image${stats.images !== 1 ? 's' : ''}</span>
                    </div>
                `;
            }
            
            if (stats.pdfs > 0) {
                fileStats.innerHTML += `
                    <div class="file-stat pdf">
                        <span>üìÑ</span>
                        <span>${stats.pdfs} PDF${stats.pdfs !== 1 ? 's' : ''}</span>
                    </div>
                `;
            }
            
            if (stats.docs > 0) {
                fileStats.innerHTML += `
                    <div class="file-stat doc">
                        <span>üìù</span>
                        <span>${stats.docs} DOC${stats.docs !== 1 ? 's' : ''}</span>
                    </div>
                `;
            }
            
            if (fileStats.innerHTML === '') {
                fileStats.innerHTML = '<div class="file-stat">No files selected</div>';
            }
        }
        
        function handleImagePrint() {
            const imageFiles = Array.from(selectedFiles.values()).filter(file => getFileType(file) === 'image');
            
            if (imageFiles.length === 0) {
                showStatus('info', 'There are no images selected to print in bulk.');
                return;
            }

            showStatus('info', `Opening print dialog for ${imageFiles.length} image(s)...`);

            const printFrame = document.createElement('iframe');
            printFrame.style.position = 'absolute';
            printFrame.style.width = '0';
            printFrame.style.height = '0';
            printFrame.style.border = '0';
            document.body.appendChild(printFrame);

            const frameDoc = printFrame.contentWindow.document;
            frameDoc.open();
            frameDoc.write(`
                <!DOCTYPE html>
                <html><head><title>Print</title>
                <style>
                    @media print {
                        @page { size: auto; margin: 20mm; }
                        body { margin: 0; }
                        img { 
                            max-width: 100%; 
                            max-height: 90vh;
                            display: block; 
                            margin: 0 auto;
                            page-break-after: always;
                        }
                    }
                </style>
                </head><body></body></html>
            `);
            frameDoc.close();

            let imagesLoaded = 0;
            imageFiles.forEach(file => {
                const img = frameDoc.createElement('img');
                img.src = URL.createObjectURL(file);
                img.onload = () => {
                    URL.revokeObjectURL(img.src);
                    imagesLoaded++;
                    if (imagesLoaded === imageFiles.length) {
                        // All images are loaded, now print
                        printFrame.contentWindow.focus();
                        printFrame.contentWindow.print();
                        setTimeout(() => {
                            document.body.removeChild(printFrame);
                        }, 1000);
                    }
                };
                frameDoc.body.appendChild(img);
            });
        }
        
        function handlePdfPrint(filename) {
            const file = selectedFiles.get(filename);
            if (!file) return;

            showStatus('info', `Opening print dialog for ${filename}...`);

            const pdfFrame = document.createElement('iframe');
            pdfFrame.style.position = 'absolute';
            pdfFrame.style.width = '0';
            pdfFrame.style.height = '0';
            pdfFrame.style.border = '0';
            
            pdfFrame.src = URL.createObjectURL(file);

            pdfFrame.onload = function() {
                try {
                    pdfFrame.contentWindow.focus();
                    pdfFrame.contentWindow.print();
                } catch (error) {
                    console.error("Failed to print PDF:", error);
                    showStatus('warning', 'Could not print automatically. Please open the PDF and print manually.');
                }
            };
            
            document.body.appendChild(pdfFrame);

            // Clean up the iframe after a delay
            setTimeout(() => {
                document.body.removeChild(pdfFrame);
                URL.revokeObjectURL(pdfFrame.src);
            }, 5000);
        }
        
        async function mergePdfFiles() {
            try {
                // Get all selected PDFs (checked checkboxes)
                const selectedPdfs = [];
                const pdfCheckboxes = document.querySelectorAll('.pdf-checkbox:checked');
                
                for (const checkbox of pdfCheckboxes) {
                    const card = checkbox.closest('.file-card');
                    if (card) {
                        const filename = card.dataset.filename;
                        const file = selectedFiles.get(filename);
                        if (file && getFileType(file) === 'pdf') {
                            selectedPdfs.push(file);
                        }
                    }
                }
                
                if (selectedPdfs.length === 0) {
                    showStatus('warning', 'No PDFs selected for merging.');
                    return;
                }
                
                if (selectedPdfs.length === 1) {
                    // Just one PDF, so print it directly
                    handlePdfPrint(selectedPdfs[0].name);
                    return;
                }
                
                showProgress(0, `Preparing to merge ${selectedPdfs.length} PDFs...`);
                
                // Access the PDF-LIB library
                const { PDFDocument } = PDFLib;
                
                // Create a new PDF document
                const mergedPdf = await PDFDocument.create();
                
                for (let i = 0; i < selectedPdfs.length; i++) {
                    const pdfFile = selectedPdfs[i];
                    showProgress((i / selectedPdfs.length) * 90, `Processing ${pdfFile.name}...`);
                    
                    // Convert the File object to an ArrayBuffer
                    const fileBuffer = await pdfFile.arrayBuffer();
                    
                    // Load the PDF document
                    const pdfDoc = await PDFDocument.load(fileBuffer);
                    
                    // Copy all pages from the source document to the merged document
                    const pages = await mergedPdf.copyPages(pdfDoc, pdfDoc.getPageIndices());
                    pages.forEach(page => mergedPdf.addPage(page));
                }
                
                showProgress(95, 'Finalizing the merged PDF...');
                
                // Save the merged PDF as a Blob
                const mergedPdfBytes = await mergedPdf.save();
                const mergedPdfBlob = new Blob([mergedPdfBytes], { type: 'application/pdf' });
                
                showProgress(100, 'PDF merge complete!');
                
                // Open the merged PDF in a new tab for printing
                const url = URL.createObjectURL(mergedPdfBlob);
                const printWindow = window.open(url, '_blank');
                
                if (printWindow) {
                    showStatus('success', 'PDFs merged successfully! Opening print dialog...');
                    // Wait for the PDF to load, then print
                    setTimeout(() => {
                        printWindow.print();
                        // Clean up
                        setTimeout(() => URL.revokeObjectURL(url), 5000);
                    }, 1000);
                } else {
                    // If popup is blocked, offer download
                    showStatus('warning', 'Popup blocked. Downloading the merged PDF instead.');
                    downloadMergedPdf(mergedPdfBlob);
                }
                
                hideProgress();
                
            } catch (error) {
                console.error('Error merging PDFs:', error);
                showStatus('error', 'Failed to merge PDFs: ' + error.message);
                hideProgress();
            }
        }
        
        function downloadMergedPdf(blob) {
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `merged_${new Date().toISOString().substring(0, 10)}.pdf`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        }

        function removeFile(filename) {
            const file = selectedFiles.get(filename);
            if (file && file.previewUrl) {
                URL.revokeObjectURL(file.previewUrl);
            }
            selectedFiles.delete(filename);
            const card = document.querySelector(`.file-card[data-filename="${filename}"]`);
            if (card) {
                card.remove();
            }
            updateStats();
            updateButtonsState();
        }

        function resetAll() {
            selectedFiles.forEach(file => {
                if (file.previewUrl) URL.revokeObjectURL(file.previewUrl);
            });
            selectedFiles.clear();
            previewArea.innerHTML = '';
            updateStats();
            updateButtonsState();
            hideStatus();
            hideProgress();
        }
        
        function updateButtonsState() {
            const hasFiles = selectedFiles.size > 0;
            const hasImages = Array.from(selectedFiles.values()).some(file => getFileType(file) === 'image');
            
            // Check for selected PDFs (with checkboxes checked)
            const selectedPdfCheckboxes = document.querySelectorAll('.pdf-checkbox:checked');
            const hasPdfs = selectedPdfCheckboxes.length > 0;
            
            printBtn.disabled = !hasImages;
            mergePdfBtn.disabled = !hasPdfs;
            resetBtn.disabled = !hasFiles;
        }
        
        function showStatus(type, message) {
            statusMessage.className = `status-message status-${type}`;
            statusMessage.textContent = message;
            statusMessage.style.display = 'block';
        }

        function hideStatus() {
            statusMessage.style.display = 'none';
        }
        
        function showProgress(percentage, message) {
            progressContainer.style.display = 'block';
            progressFill.style.width = `${percentage}%`;
            progressText.textContent = message || `${Math.round(percentage)}% Complete`;
        }
        
        function hideProgress() {
            progressContainer.style.display = 'none';
        }

        // --- Helper Functions ---

        function getFileType(file) {
            const name = file.name.toLowerCase();
            if (file.type.startsWith('image/')) return 'image';
            if (file.type === 'application/pdf' || name.endsWith('.pdf')) return 'pdf';
            if (file.type.includes('word') || name.endsWith('.doc') || name.endsWith('.docx')) return 'doc';
            return 'unsupported';
        }

        function formatBytes(bytes, decimals = 2) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const dm = decimals < 0 ? 0 : decimals;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];
        }<think>

**Handling New Requirements: Merge PDF & DOC Files**

I need to clarify the user's request. They're acknowledging the limitation with direct printing of PDFs and DOCs from the browser, and are now requesting an alternative approach: a "merge and print" button after file upload.

**Understanding the Technical Requirements**

1. Browser-side merging of PDFs is possible using libraries like PDF.js, but merging DOC files in the browser is extremely difficult as there aren't robust JavaScript libraries for this purpose.

2. Client-side merging of PDFs is possible but has limitations:
   - Requires loading a substantial library
   - May be slow for large files
   - Won't handle DOC/DOCX files

3. For a web app without a server component, I'll need to:
   - Be clear about what's technically possible
   - Implement PDF merging using a library like pdf-lib
   - Provide a graceful fallback for DOC files

**Planning the Implementation**

1. **User Interface Changes:**
   - Add a "Merge PDFs" button that only appears when multiple PDFs are selected
   - Keep individual PDF print buttons for flexibility
   - Show a clear message about DOC files not being mergeable

2. **Technical Implementation:**
   - Include the pdf-lib.js library for PDF merging
   - Implement a function to merge selected PDFs
   - Create a downloadable merged PDF file
   - For printing, open the merged PDF in a new tab or trigger the print dialog

3. **Constraints to Address:**
   - Need to be clear that DOC/DOCX files cannot be merged
   - The merge operation might be memory-intensive for many PDFs
   - The solution requires modern browser features

I'll implement this solution while maintaining the existing functionality for printing images and individual PDFs.

</think>

Based on your request, I'll implement a solution that allows users to merge multiple PDF files into a single document that can then be viewed and printed. Since browsers cannot directly manipulate DOC/DOCX files, these will still need to be handled separately.

Here's the updated code with the following new features:

1. A "Merge PDFs" button that appears when multiple PDFs are selected
2. PDF merging functionality using the pdf-lib library
3. Clear messaging about file compatibility
4. Ability to download the merged PDF file

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bulk File Printer & PDF Merger</title>
    <style>
        :root {
            --primary-color: #007bff;
            --secondary-color: #6c757d;
            --light-color: #f8f9fa;
            --dark-color: #343a40;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --info-color: #17a2b8;
            --warning-color: #ffc107;
            --border-radius: 12px;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease-in-out;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #e9ecef;
            min-height: 100vh;
            padding: 20px;
            color: var(--dark-color);
            line-height: 1.6;
        }

        .container {
            max-width: 1100px;
            margin: 0 auto;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            overflow: hidden;
        }

        .header {
            text-align: center;
            padding: 40px 20px;
            background: linear-gradient(135deg, var(--primary-color), #0056b3);
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .main-content {
            padding: 30px;
        }

        .controls-section {
            background: var(--light-color);
            padding: 20px;
            border-radius: var(--border-radius);
            margin-bottom: 30px;
            text-align: center;
        }
        
        .upload-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .upload-btn {
            background: white;
            color: var(--primary-color);
            border: 2px solid var(--primary-color);
            padding: 15px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: var(--transition);
        }

        .upload-btn:hover {
            background: var(--primary-color);
            color: white;
            transform: translateY(-2px);
        }
        
        .upload-note {
            font-size: 0.85rem;
            color: var(--secondary-color);
        }

        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 30px;
            border-top: 1px solid #dee2e6;
            padding-top: 20px;
            flex-wrap: wrap;
        }

        .print-btn, .reset-btn, .merge-btn {
            color: white;
            border: none;
            padding: 12px 35px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: var(--transition);
        }
        
        .print-btn {
            background: linear-gradient(135deg, var(--success-color), #1e7e34);
        }
        
        .reset-btn {
            background: linear-gradient(135deg, var(--danger-color), #a71d2a);
        }
        
        .merge-btn {
            background: linear-gradient(135deg, var(--primary-color), #0056b3);
        }

        .print-btn:hover, .reset-btn:hover, .merge-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }
        
        .print-btn:disabled, .reset-btn:disabled, .merge-btn:disabled {
            background: #ced4da;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .preview-area {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 20px;
            min-height: 100px;
        }
        
        .file-type-stats {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .file-stat {
            background: var(--light-color);
            padding: 10px 20px;
            border-radius: 30px;
            font-size: 0.9rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .file-stat.image {
            color: var(--success-color);
            border: 1px solid var(--success-color);
        }
        
        .file-stat.pdf {
            color: var(--danger-color);
            border: 1px solid var(--danger-color);
        }
        
        .file-stat.doc {
            color: var(--primary-color);
            border: 1px solid var(--primary-color);
        }

        .file-card {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            transition: var(--transition);
            border: 1px solid #dee2e6;
        }
        
        .file-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }

        .preview-container {
            height: 180px;
            background-color: var(--light-color);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        
        .preview-container img, .preview-container iframe {
            width: 100%;
            height: 100%;
            object-fit: contain;
            border: none;
        }

        .file-icon {
            width: 60px;
            height: 60px;
            color: var(--secondary-color);
        }
        
        .file-checkbox {
            position: absolute;
            top: 10px;
            right: 10px;
            transform: scale(1.5);
        }
        
        .unsupported-text {
            position: absolute;
            bottom: 10px;
            left: 10px;
            right: 10px;
            background: rgba(0,0,0,0.6);
            color: white;
            font-size: 0.8rem;
            padding: 5px;
            border-radius: 4px;
            text-align: center;
        }

        .file-info {
            padding: 15px;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        .file-name {
            font-weight: 600;
            word-break: break-all;
            flex-grow: 1;
            margin-bottom: 5px;
        }

        .file-details {
            font-size: 0.85rem;
            color: var(--secondary-color);
        }
        
        .card-actions {
            display: flex;
            gap: 5px;
            margin-top: 15px;
        }

        .remove-file-btn, .print-pdf-btn {
            flex-grow: 1;
            color: white;
            border: none;
            padding: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: background-color 0.2s;
            border-radius: 8px;
        }
        
        .remove-file-btn {
            background: var(--danger-color);
        }

        .print-pdf-btn {
             background: var(--info-color);
        }
        
        .remove-file-btn:hover {
            background: #a71d2a;
        }
        
        .print-pdf-btn:hover {
            background: #117a8b;
        }

        .status-message {
            padding: 15px 20px;
            border-radius: 8px;
            margin: 0 0 20px 0;
            text-align: center;
            font-weight: 600;
            border: 1px solid;
        }

        .status-info {
            background: #d1ecf1;
            color: #0c5460;
            border-color: #bee5eb;
        }
        
        .status-warning {
            background: #fff3cd;
            color: #856404;
            border-color: #ffeeba;
        }
        
        .status-success {
            background: #d4edda;
            color: #155724;
            border-color: #c3e6cb;
        }
        
        .status-error {
            background: #f8d7da;
            color: #721c24;
            border-color: #f5c6cb;
        }

        .progress-container {
            margin: 20px 0;
            display: none;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), #0056b3);
            width: 0%;
            transition: width 0.3s ease;
        }

        .progress-text {
            text-align: center;
            margin-top: 5px;
            font-weight: 600;
            font-size: 0.9rem;
            color: var(--secondary-color);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Bulk File Printer & PDF Merger</h1>
            <p>Select multiple files to print or merge them into a single document.</p>
        </div>

        <div class="main-content">
            <div class="controls-section">
                <!-- Inputs are hidden, labels act as buttons -->
                <input type="file" id="fileInput" multiple accept="image/*,application/pdf,.doc,.docx" style="display: none;">
                <input type="file" id="folderInput" webkitdirectory directory multiple style="display: none;">
                
                <div class="upload-buttons">
                    <label for="fileInput" class="upload-btn">Select Files</label>
                    <label for="folderInput" class="upload-btn">Select Folder</label>
                </div>
                <p class="upload-note">Note: Images can be bulk printed. PDFs can be merged into a single document. DOC/DOCX files must be handled separately.</p>
            </div>
            
            <div id="fileStats" class="file-type-stats">
                <!-- File type stats will be added here -->
            </div>
            
            <div id="statusMessage" class="status-message status-info" style="display: none;"></div>
            
            <div id="progressContainer" class="progress-container">
                <div class="progress-bar">
                    <div id="progressFill" class="progress-fill"></div>
                </div>
                <div id="progressText" class="progress-text">Processing...</div>
            </div>

            <div class="preview-area" id="previewArea">
                <!-- File previews will be dynamically added here -->
            </div>
            
            <div class="action-buttons">
                <button class="print-btn" id="printBtn" disabled>üñ®Ô∏è Print All Images</button>
                <button class="merge-btn" id="mergePdfBtn" disabled>üîÑ Merge & Print PDFs</button>
                <button class="reset-btn" id="resetBtn" disabled>üóëÔ∏è Reset All</button>
            </div>
        </div>
    </div>

    <!-- PDF-LIB for PDF merging -->
    <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
    
    <script>
        // DOM Elements
        const fileInput = document.getElementById('fileInput');
        const folderInput = document.getElementById('folderInput');
        const previewArea = document.getElementById('previewArea');
        const printBtn = document.getElementById('printBtn');
        const mergePdfBtn = document.getElementById('mergePdfBtn');
        const resetBtn = document.getElementById('resetBtn');
        const statusMessage = document.getElementById('statusMessage');
        const progressContainer = document.getElementById('progressContainer');
        const progressFill = document.getElementById('progressFill');
        const progressText = document.getElementById('progressText');
        const fileStats = document.getElementById('fileStats');

        let selectedFiles = new Map(); // Use a Map to prevent duplicates and store File objects

        // --- Event Listeners ---
        fileInput.addEventListener('change', (event) => handleFiles(event.target.files));
        folderInput.addEventListener('change', (event) => handleFiles(event.target.files));
        printBtn.addEventListener('click', handleImagePrint);
        mergePdfBtn.addEventListener('click', mergePdfFiles);
        resetBtn.addEventListener('click', resetAll);
        
        // --- Core Functions ---

        function handleFiles(files) {
            for (const file of files) {
                if (!selectedFiles.has(file.name)) {
                    selectedFiles.set(file.name, file);
                    createFileCard(file);
                }
            }
            updateStats();
            updateButtonsState();
        }

        function createFileCard(file) {
            const card = document.createElement('div');
            card.className = 'file-card';
            card.dataset.filename = file.name;

            const previewContainer = document.createElement('div');
            previewContainer.className = 'preview-container';

            const fileType = getFileType(file);
            const actionsDiv = document.createElement('div');
            actionsDiv.className = 'card-actions';

            switch (fileType) {
                case 'image':
                    const img = document.createElement('img');
                    img.src = URL.createObjectURL(file);
                    img.alt = `Preview of ${file.name}`;
                    img.onload = () => URL.revokeObjectURL(img.src);
                    previewContainer.appendChild(img);
                    break;
                case 'pdf':
                    previewContainer.innerHTML = getIconSVG('pdf');
                    // Add a PDF checkbox for merging
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.className = 'file-checkbox pdf-checkbox';
                    checkbox.checked = true;
                    checkbox.onchange = updateButtonsState;
                    previewContainer.appendChild(checkbox);
                    
                    // Individual print button
                    actionsDiv.innerHTML += `<button class="print-pdf-btn" onclick="handlePdfPrint('${file.name}')">üñ®Ô∏è Print</button>`;
                    break;
                case 'doc':
                     previewContainer.innerHTML = getIconSVG('doc');
                     previewContainer.innerHTML += `<div class="unsupported-text">DOC files can't be merged</div>`;
                    break;
                default:
                     previewContainer.innerHTML = getIconSVG('generic');
                     previewContainer.innerHTML += `<div class="unsupported-text">Unsupported File</div>`;
                    break;
            }

            const infoDiv = document.createElement('div');
            infoDiv.className = 'file-info';
            infoDiv.innerHTML = `
                <div class="file-name">${file.name}</div>
                <div class="file-details">${formatBytes(file.size)}</div>
            `;
            
            // Add the remove button to all cards
            actionsDiv.innerHTML += `<button class="remove-file-btn" onclick="removeFile('${file.name}')">Remove</button>`;
            infoDiv.appendChild(actionsDiv);

            card.appendChild(previewContainer);
            card.appendChild(infoDiv);
            previewArea.appendChild(card);
        }
        
        function updateStats() {
            const stats = {
                images: 0,
                pdfs: 0,
                docs: 0
            };
            
            selectedFiles.forEach(file => {
                const type = getFileType(file);
                if (type === 'image') stats.images++;
                if (type === 'pdf') stats.pdfs++;
                if (type === 'doc') stats.docs++;
            });
            
            fileStats.innerHTML = '';
            
            if (stats.images > 0) {
                fileStats.innerHTML += `
                    <div class="file-stat image">
                        <span>üì∑</span>
                        <span>${stats.images} Image${stats.images !== 1 ? 's' : ''}</span>
                    </div>
                `;
            }
            
            if (stats.pdfs > 0) {
                fileStats.innerHTML += `
                    <div class="file-stat pdf">
                        <span>üìÑ</span>
                        <span>${stats.pdfs} PDF${stats.pdfs !== 1 ? 's' : ''}</span>
                    </div>
                `;
            }
            
            if (stats.docs > 0) {
                fileStats.innerHTML += `
                    <div class="file-stat doc">
                        <span>üìù</span>
                        <span>${stats.docs} DOC${stats.docs !== 1 ? 's' : ''}</span>
                    </div>
                `;
            }
            
            if (fileStats.innerHTML === '') {
                fileStats.innerHTML = '<div class="file-stat">No files selected</div>';
            }
        }
        
        function handleImagePrint() {
            const imageFiles = Array.from(selectedFiles.values()).filter(file => getFileType(file) === 'image');
            
            if (imageFiles.length === 0) {
                showStatus('info', 'There are no images selected to print in bulk.');
                return;
            }

            showStatus('info', `Opening print dialog for ${imageFiles.length} image(s)...`);

            const printFrame = document.createElement('iframe');
            printFrame.style.position = 'absolute';
            printFrame.style.width = '0';
            printFrame.style.height = '0';
            printFrame.style.border = '0';
            document.body.appendChild(printFrame);

            const frameDoc = printFrame.contentWindow.document;
            frameDoc.open();
            frameDoc.write(`
                <!DOCTYPE html>
                <html><head><title>Print</title>
                <style>
                    @media print {
                        @page { size: auto; margin: 20mm; }
                        body { margin: 0; }
                        img { 
                            max-width: 100%; 
                            max-height: 90vh;
                            display: block; 
                            margin: 0 auto;
                            page-break-after: always;
                        }
                    }
                </style>
                </head><body></body></html>
            `);
            frameDoc.close();

            let imagesLoaded = 0;
            imageFiles.forEach(file => {
                const img = frameDoc.createElement('img');
                img.src = URL.createObjectURL(file);
                img.onload = () => {
                    URL.revokeObjectURL(img.src);
                    imagesLoaded++;
                    if (imagesLoaded === imageFiles.length) {
                        // All images are loaded, now print
                        printFrame.contentWindow.focus();
                        printFrame.contentWindow.print();
                        setTimeout(() => {
                            document.body.removeChild(printFrame);
                        }, 1000);
                    }
                };
                frameDoc.body.appendChild(img);
            });
        }
        
        function handlePdfPrint(filename) {
            const file = selectedFiles.get(filename);
            if (!file) return;

            showStatus('info', `Opening print dialog for ${filename}...`);

            const pdfFrame = document.createElement('iframe');
            pdfFrame.style.position = 'absolute';
            pdfFrame.style.width = '0';
            pdfFrame.style.height = '0';
            pdfFrame.style.border = '0';
            
            pdfFrame.src = URL.createObjectURL(file);

            pdfFrame.onload = function() {
                try {
                    pdfFrame.contentWindow.focus();
                    pdfFrame.contentWindow.print();
                } catch (error) {
                    console.error("Failed to print PDF:", error);
                    showStatus('warning', 'Could not print automatically. Please open the PDF and print manually.');
                }
            };
            
            document.body.appendChild(pdfFrame);

            // Clean up the iframe after a delay
            setTimeout(() => {
                document.body.removeChild(pdfFrame);
                URL.revokeObjectURL(pdfFrame.src);
            }, 5000);
        }
        
        async function mergePdfFiles() {
            try {
                // Get all selected PDFs (checked checkboxes)
                const selectedPdfs = [];
                const pdfCheckboxes = document.querySelectorAll('.pdf-checkbox:checked');
                
                for (const checkbox of pdfCheckboxes) {
                    const card = checkbox.closest('.file-card');
                    if (card) {
                        const filename = card.dataset.filename;
                        const file = selectedFiles.get(filename);
                        if (file && getFileType(file) === 'pdf') {
                            selectedPdfs.push(file);
                        }
                    }
                }
                
                if (selectedPdfs.length === 0) {
                    showStatus('warning', 'No PDFs selected for merging.');
                    return;
                }
                
                if (selectedPdfs.length === 1) {
                    // Just one PDF, so print it directly
                    handlePdfPrint(selectedPdfs[0].name);
                    return;
                }
                
                showProgress(0, `Preparing to merge ${selectedPdfs.length} PDFs...`);
                
                // Access the PDF-LIB library
                const { PDFDocument } = PDFLib;
                
                // Create a new PDF document
                const mergedPdf = await PDFDocument.create();
                
                for (let i = 0; i < selectedPdfs.length; i++) {
                    const pdfFile = selectedPdfs[i];
                    showProgress((i / selectedPdfs.length) * 90, `Processing ${pdfFile.name}...`);
                    
                    // Convert the File object to an ArrayBuffer
                    const fileBuffer = await pdfFile.arrayBuffer();
                    
                    // Load the PDF document
                    const pdfDoc = await PDFDocument.load(fileBuffer);
                    
                    // Copy all pages from the source document to the merged document
                    const pages = await mergedPdf.copyPages(pdfDoc, pdfDoc.getPageIndices());
                    pages.forEach(page => mergedPdf.addPage(page));
                }
                
                showProgress(95, 'Finalizing the merged PDF...');
                
                // Save the merged PDF as a Blob
                const mergedPdfBytes = await mergedPdf.save();
                const mergedPdfBlob = new Blob([mergedPdfBytes], { type: 'application/pdf' });
                
                showProgress(100, 'PDF merge complete!');
                
                // Open the merged PDF in a new tab for printing
                const url = URL.createObjectURL(mergedPdfBlob);
                const printWindow = window.open(url, '_blank');
                
                if (printWindow) {
                    showStatus('success', 'PDFs merged successfully! Opening print dialog...');
                    // Wait for the PDF to load, then print
                    setTimeout(() => {
                        printWindow.print();
                        // Clean up
                        setTimeout(() => URL.revokeObjectURL(url), 5000);
                    }, 1000);
                } else {
                    // If popup is blocked, offer download
                    showStatus('warning', 'Popup blocked. Downloading the merged PDF instead.');
                    downloadMergedPdf(mergedPdfBlob);
                }
                
                hideProgress();
                
            } catch (error) {
                console.error('Error merging PDFs:', error);
                showStatus('error', 'Failed to merge PDFs: ' + error.message);
                hideProgress();
            }
        }
        
        function downloadMergedPdf(blob) {
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `merged_${new Date().toISOString().substring(0, 10)}.pdf`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        }

        function removeFile(filename) {
            const file = selectedFiles.get(filename);
            if (file && file.previewUrl) {
                URL.revokeObjectURL(file.previewUrl);
            }
            selectedFiles.delete(filename);
            const card = document.querySelector(`.file-card[data-filename="${filename}"]`);
            if (card) {
                card.remove();
            }
            updateStats();
            updateButtonsState();
        }

        function resetAll() {
            selectedFiles.forEach(file => {
                if (file.previewUrl) URL.revokeObjectURL(file.previewUrl);
            });
            selectedFiles.clear();
            previewArea.innerHTML = '';
            updateStats();
            updateButtonsState();
            hideStatus();
            hideProgress();
        }
        
        function updateButtonsState() {
            const hasFiles = selectedFiles.size > 0;
            const hasImages = Array.from(selectedFiles.values()).some(file => getFileType(file) === 'image');
            
            // Check for selected PDFs (with checkboxes checked)
            const selectedPdfCheckboxes = document.querySelectorAll('.pdf-checkbox:checked');
            const hasPdfs = selectedPdfCheckboxes.length > 0;
            
            printBtn.disabled = !hasImages;
            mergePdfBtn.disabled = !hasPdfs;
            resetBtn.disabled = !hasFiles;
        }
        
        function showStatus(type, message) {
            statusMessage.className = `status-message status-${type}`;
            statusMessage.textContent = message;
            statusMessage.style.display = 'block';
        }

        function hideStatus() {
            statusMessage.style.display = 'none';
        }
        
        function showProgress(percentage, message) {
            progressContainer.style.display = 'block';
            progressFill.style.width = `${percentage}%`;
            progressText.textContent = message || `${Math.round(percentage)}% Complete`;
        }
        
        function hideProgress() {
            progressContainer.style.display = 'none';
        }

        // --- Helper Functions ---

        function getFileType(file) {
            const name = file.name.toLowerCase();
            if (file.type.startsWith('image/')) return 'image';
            if (file.type === 'application/pdf' || name.endsWith('.pdf')) return 'pdf';
            if (file.type.includes('word') || name.endsWith('.doc') || name.endsWith('.docx')) return 'doc';
            return 'unsupported';
        }

        function formatBytes(bytes, decimals = 2) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const dm = decimals < 0 ? 0 : decimals;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];
        }
                function getIconSVG(type) {
            const icons = {
                pdf: `<svg class="file-icon" style="color:#dc3545" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6zM9.5 18H8v-2.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-.5.5zm-2-3H6v-2.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5V15zm4.5-1a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM16 12h-2.5a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5H16v2.5zm-3-4a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5z"/></svg>`,
                doc: `<svg class="file-icon" style="color:#007bff" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6zM16 18H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/></svg>`,
                generic: `<svg class="file-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6zM12 18a4 4 0 1 1 0-8 4 4 0 0 1 0 8zm0-6a2 2 0 1 0 0 4 2 2 0 0 0 0-4z"/></svg>`
            };
            return icons[type] || icons.generic;
        }

        // Initialize the UI with empty stats
        document.addEventListener('DOMContentLoaded', function() {
            fileStats.innerHTML = '<div class="file-stat">No files selected</div>';
            
            // Check if browser supports directory selection
            if (!('webkitdirectory' in document.createElement('input'))) {
                document.querySelector('label[for="folderInput"]').style.display = 'none';
                document.querySelector('.upload-note').innerHTML += '<br><strong>Note:</strong> Folder selection not supported in your browser.';
            }
            
            // Show initial status message
            showStatus('info', 'Select files to get started. Images will be printed together, PDFs can be merged.');
            setTimeout(() => {
                hideStatus();
            }, 5000);
        });

        // Check if PDF merging is supported in this browser
        function isPdfMergingSupported() {
            return typeof PDFLib !== 'undefined' && typeof PDFLib.PDFDocument !== 'undefined';
        }

        // Handle potential errors with PDF-LIB loading
        window.addEventListener('error', function(e) {
            if (e.message.includes('PDFLib') || e.message.includes('pdf-lib')) {
                console.error('PDF library failed to load:', e);
                showStatus('error', 'PDF merging functionality could not be loaded. Please refresh the page or try a different browser.');
            }
        });

        // Modern browsers compatibility check
        function checkBrowserCompatibility() {
            const isModernBrowser = 'fetch' in window && 'Promise' in window && 'FileReader' in window && 'URL' in window;
            
            if (!isModernBrowser) {
                showStatus('warning', 'Your browser may not support all features of this application. For the best experience, please use a modern browser like Chrome, Firefox, or Edge.');
            }
            
            return isModernBrowser;
        }

        checkBrowserCompatibility();

        // Additional useful functions

        // Function to get file extension
        function getFileExtension(filename) {
            return filename.slice((filename.lastIndexOf('.') - 1 >>> 0) + 2).toLowerCase();
        }

        // Helper function to check if a file is an image
        function isImageFile(file) {
            return file.type.startsWith('image/') || 
                   ['jpg', 'jpeg', 'png', 'gif', 'bmp', 'webp', 'tiff'].includes(getFileExtension(file.name));
        }

        // Helper function to check if a file is a PDF
        function isPdfFile(file) {
            return file.type === 'application/pdf' || getFileExtension(file.name) === 'pdf';
        }

        // Helper function to check if a file is a DOC/DOCX
        function isDocFile(file) {
            const ext = getFileExtension(file.name);
            return file.type.includes('word') || ext === 'doc' || ext === 'docx';
        }

        // Function to create a unified filename for the merged PDF
        function createMergedPdfFilename() {
            const date = new Date();
            const timestamp = date.toISOString().replace(/[:.]/g, '-').substring(0, 19);
            return `merged_documents_${timestamp}.pdf`;
        }

        // Function to sanitize filenames for download
        function sanitizeFilename(name) {
            return name.replace(/[^a-zA-Z0-9_\-\.]/g, '_');
        }

        // Function to get mime type based on file extension
        function getMimeType(filename) {
            const ext = getFileExtension(filename);
            const mimeTypes = {
                'jpg': 'image/jpeg',
                'jpeg': 'image/jpeg',
                'png': 'image/png',
                'gif': 'image/gif',
                'bmp': 'image/bmp',
                'webp': 'image/webp',
                'tiff': 'image/tiff',
                'pdf': 'application/pdf',
                'doc': 'application/msword',
                'docx': 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'
            };
            return mimeTypes[ext] || 'application/octet-stream';
        }

        // Function to generate a preview PDF page with unsupported file information
        async function generateUnsupportedFilePage(filename, fileType) {
            const { PDFDocument, rgb, StandardFonts } = PDFLib;
            
            const pdfDoc = await PDFDocument.create();
            const page = pdfDoc.addPage([600, 800]);
            const helveticaFont = await pdfDoc.embedFont(StandardFonts.Helvetica);
            const helveticaBoldFont = await pdfDoc.embedFont(StandardFonts.HelveticaBold);

            page.drawText('Unsupported File Format', {
                x: 50,
                y: 750,
                size: 24,
                font: helveticaBoldFont,
                color: rgb(0.8, 0.2, 0.2)
            });

            page.drawText(`Filename: ${filename}`, {
                x: 50,
                y: 700,
                size: 14,
                font: helveticaFont,
                color: rgb(0, 0, 0)
            });

            page.drawText(`File Type: ${fileType}`, {
                x: 50,
                y: 675,
                size: 14,
                font: helveticaFont,
                color: rgb(0, 0, 0)
            });

            page.drawText('This file cannot be previewed or printed directly from the browser.', {
                x: 50,
                y: 625,
                size: 12,
                font: helveticaFont,
                color: rgb(0.3, 0.3, 0.3)
            });

            page.drawText('Please download and open the file with an appropriate application.', {
                x: 50,
                y: 600,
                size: 12,
                font: helveticaFont,
                color: rgb(0.3, 0.3, 0.3)
            });

            return await pdfDoc.save();
        }

        // Attach file selection handling via drag and drop
        document.addEventListener('dragover', function(e) {
            e.preventDefault();
            e.stopPropagation();
        });

        document.addEventListener('dragenter', function(e) {
            e.preventDefault();
            e.stopPropagation();
            document.body.style.backgroundColor = '#e2e8f0';
        });

        document.addEventListener('dragleave', function(e) {
            e.preventDefault();
            e.stopPropagation();
            document.body.style.backgroundColor = '';
        });

        document.addEventListener('drop', function(e) {
            e.preventDefault();
            e.stopPropagation();
            document.body.style.backgroundColor = '';
            
            if (e.dataTransfer.files && e.dataTransfer.files.length > 0) {
                handleFiles(e.dataTransfer.files);
            }
        });

        // Add a keyboard shortcut to open file dialog (Ctrl+O)
        document.addEventListener('keydown', function(e) {
            if ((e.ctrlKey || e.metaKey) && e.key === 'o') {
                e.preventDefault();
                document.getElementById('fileInput').click();
            }
        });
    </script>


            <script></script>
        
    
</body>
